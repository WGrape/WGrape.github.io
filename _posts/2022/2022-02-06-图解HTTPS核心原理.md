---
layout:     post
title:      图解HTTPS核心原理
header-img: /img/post.png
catalog: true
tags:
- HTTPS
---

> 文章内容更新请以 [WGrape GitHub博客 : 图解HTTPS核心原理](https://github.com/WGrape/Blog/issues/34) 为准

### 目录
- [一、HTTP](#1)
- &nbsp;&nbsp;&nbsp;&nbsp; [1、HTTP存在的问题](#11)
- [二、HTTPS实现过程](#2)
- &nbsp;&nbsp;&nbsp;&nbsp; [1、加密传输](#21)
- &nbsp;&nbsp;&nbsp;&nbsp; [2、如何决定秘钥](#22)
- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [(1) 信中传递秘钥](#221)
- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [(2) 传递未上锁的盒子](#222)
- &nbsp;&nbsp;&nbsp;&nbsp; [3、如何信任盒子](#23)
- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [(1) 盒子可以被篡改](#231)
- &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [(2) 让信任机构给盒子签名](#232)
- &nbsp;&nbsp;&nbsp;&nbsp; [4、对称加密和非对称加密](#24)
- &nbsp;&nbsp;&nbsp;&nbsp; [5、完整过程](#25)
- [三、HTTPS核心原理](#3)
- &nbsp;&nbsp;&nbsp;&nbsp; [1、使用的协议](#31)
- &nbsp;&nbsp;&nbsp;&nbsp; [2、加密过程](#32)
- [四、附录](#4)

## <span id="1">一、HTTP</span>
分手后，小明向小红发送了一条内容为```miss you```的消息，但不巧的是，这条消息被骇客截获并识别出消息内容后，偷偷地篡改为```hate you```，导致小明失去了一次挽回小红的机会。

<img width="525" alt="image" src="https://user-images.githubusercontent.com/35942268/155848093-88220fd9-99ac-48f7-a8df-0051742565e2.png">


### <span id="11">1、HTTP存在的问题</span>
- 未使用任何加密，明文传输
- 传输的数据在任何网络设备上都有被截获的可能

## <span id="2">二、HTTPS实现过程</span>
对于上述HTTP在出传输过程中存在的问题，可以使用如下解决方案

### <span id="21">1、加密传输</span>
小明和小红在分手前约定了一个聊天规则，信息中的每个字母都要按照字母表中的顺序后移三位，比如 ```A -> D ，B -> E ```。在分手后，小明想要发送的```miss you```消息，就变成了```Plvv brx```。这时即使信息被骇客截获，但由于无法识别内容，无法进行修改，所以只能原样传输给小红，小红拿到消息后按照约定的规则，得出了真正的信息```miss you```。

> 骇客原则上可以任意更新任何接收到的消息，但问题就在于，如果无法正确识别内容，也随意修改数据，就会导致传输过程中出错，骇客的身份也就会被暴露无遗。

这种传输时使用的加密方式，称为对称加密（对称秘钥加密），即双方使用的秘钥完全一致。

### <span id="22">2、如何决定秘钥</span>
上述对称加密传输方案是建立在双方已知秘钥的前提下，但是小明与小红第一次见面的时候，他们还没有一个安全的确立秘钥的方式。

#### <span id="221">(1) 信中传递秘钥</span>
如果他们在信中传递秘钥，那么秘钥就会完整被骇客截获，监听并篡改二人的聊天信息。

<img width="525" alt="image" src="https://user-images.githubusercontent.com/35942268/155849413-7a4adca0-7e20-4548-91b0-f0f24438c5aa.png">

#### <span id="222">(2) 传递未上锁的盒子</span>
小明向小红传递一个未上锁的盒子，小红接收后把秘钥放到盒子中并**上锁**后回传给小明，即使过程中骇客截获盒子，也没有锁打开盒子，所以无法截获正确的秘钥。

<img width="525" alt="image" src="https://user-images.githubusercontent.com/35942268/155849691-da25baa2-f1be-4474-862d-ed1f2fb62f32.png">

这种方式称为非对称密钥加密。之所以称之为非对称，是因为你即使把信息编码（锁上盒子）也不能破译信息（打开锁住的盒子）。在术语中，盒子被称为**公匙**，用来打开盒子的钥匙被称为**私匙**

### <span id="23">3、如何信任盒子</span>

#### <span id="231">(1) 盒子可以被篡改</span>
在小明向小红传递未上锁盒子的过程中，盒子可能会被骇客截获，这样还是会有被监听和篡改的风险。

<img width="525" alt="image" src="https://user-images.githubusercontent.com/35942268/155849998-894c8d49-c5e4-4328-a242-014106dea3c8.png">

#### <span id="232">(2) 让信任机构给盒子签名</span>
如何让小红正确识别出盒子是小明的呢，小明想到了一个让信任机构给盒子签名的方式，这时小红接收到箱子时只要看到这个签名，就能相信这确实是来自于小明的合法盒子了。

那么什么是信任机构呢，就是它是一个只会给合法人签名的非常值得信赖的机构。所以只要能有对方的签名，就能完全相信这是一个合法的来自对方的盒子了。

### <span id="24">4、对称加密和非对称加密</span>
由于对称加密和非对称加密各有优劣，所以可以采用对称加密和非对称加密结合的方式。

- 对称加密     ：建立秘钥之后，双方直接传输被加密后的信息
- 非对称加密 ：双方先传递未上锁且被信任机构签名的盒子，然后把秘钥放入盒子中，进而建立秘钥

### <span id="25">5、完整过程</span>
双方先通过非对称加密的方式，建立可信任的秘钥，然后再使用对称加密的方式，传输数据。

客户端： 验证密钥， 验证， 是， 生成随机key， 复制密钥， 使用key解密内容
服务器： 公钥，私钥 使用 私钥解密 获取key，使用key隐藏内容

- 请求网站
- 生成公钥和私钥
- 响应公钥
- 验证是否https，生成随机key，复制密钥
- 隐藏传输随机key
- 使用私钥，获取key，使用key隐藏内容
- 使用客户端key响应加密内容
- 使用key解密内容

## <span id="3">三、HTTPS核心原理</span>

### <span id="31">1、使用的协议</span>
HTTPS主要基于```SSL/TLS```协议

<img width="525" src="https://user-images.githubusercontent.com/35942268/155850370-565639aa-12d9-49c7-a239-eea21d762e5b.png">

### <span id="32">2、加密过程</span>
先使用非对称加密的方式，建立秘钥，然后再使用对称加密的方式加密信息，最后使用散列算法验证信息的完整性，以确保接收到的信息正确无误。

<img width="525" src="https://user-images.githubusercontent.com/35942268/155850466-77fb07c4-a73c-4604-85ac-a7218b20ab1b.png">

## <span id="4">四、附录</span>
- 建立秘钥 ：达到只有双方知道秘钥的效果

